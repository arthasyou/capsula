# 项目工作进展汇报

## 1. 总体概况

- 已完成“Capsula”工作区的核心组件搭建，包括密码学库、密钥管理、PKI 服务、数据胶囊引擎、跨平台接口等多个 crate。
- 通过 `capsula-key`、`capsula-crypto`、`capsula-core` 等库，已经具备数据胶囊封装、签名、解密的底层能力。
- `capsula-api` 提供标准化的 PKI REST 服务，`capsula-cli`、`capsula-wasm`、`capsula-ffi` 支持命令行、前端和原生系统接入。
- `capsula-bank` 引入上述能力，构建面向数据银行场景的 Axum 服务端，目前处于功能串接与场景落地阶段。

## 2. 各子模块进展

| 模块             | 主要成果                                                       | 当前状态                                     |
| ---------------- | -------------------------------------------------------------- | -------------------------------------------- |
| `capsula-crypto` | 提供 RSA、Ed25519、P256 等多算法支持，丰富签名/哈希能力        | 功能已实现，可作为底层依赖使用               |
| `capsula-key`    | 多算法密钥生成、导入导出、存储加密、轮换机制                   | 功能稳定，为 PKI/胶囊封装提供密钥支撑        |
| `capsula-core`   | 实现 Cap0/Cap1/Cap2 胶囊封装与验证、策略框架、审计结构         | 作为数据胶囊引擎已可用，待与业务服务深化结合 |
| `capsula-pki`    | 构建证书签发、验证、吊销、证书链管理等 CA 能力                 | 功能完善，尚待与数据银行流程打通             |
| `capsula-api`    | 对外提供 PKI REST API，附带 Swagger 文档                       | 可独立部署，支撑证书管理场景                 |
| `capsula-cli`    | 支持密钥/证书命令行操作、批处理                                | 可用于运维及离线作业                         |
| `capsula-wasm`   | 提供浏览器/Node.js 环境的加密操作                              | 功能可用，用于前端集成                       |
| `capsula-ffi`    | 暴露 C/C++ FFI 接口，便于跨语言调用                            | 已具备基本封装，需按需扩展                   |
| `capsula-bank`   | Axum 服务端；已实现胶囊 CRUD、令牌授权、上传流水线、LLM 汇总等 | 与各底层库集成进行中，部分流程仍为占位实现   |

## 3. `capsula-bank` 集成进展

- **胶囊管理 V1**：完成 SurrealDB 表结构，支持胶囊创建、按 ID/Owner 查询、组合检索。
- **权限/令牌**：实现令牌生成、验证、撤销及查询流程，内置原子/分子权限矩阵，提供初始化脚本。
- **V2 流水线**：封装服务对接文本提取、BNF 解析、元数据生成、存储写入与 Cap1 创建；Cap0 仍为 TODO。
- **多级视图**：提供 Level0 直接投影与 Level1 LLM 汇总接口，对应 PPT 中的披露等级需求。
- **配置与基础设施**：加载系统私钥、初始化日志、集成 Swagger UI、准备临时文件守卫与本地存储实现。

## 4. 当前存在的主要差距

1. **Cap0 封装与外部存储**：`CapsuleSealer::create_cap0` 尚未实现，仍缺少完整的原始数据加密与引用写入逻辑。
2. **真实存储/预签名 URL**：当前仅提供本地存储与占位预签名 URL，需要接入 S3/MinIO 并完善上传校验。
3. **PKI/证书流程**：`capsula-bank` 尚未与 `capsula-pki` 的证书申请、吊销、审计流程联动。
4. **权限闭环**：胶囊访问接口未全面接入原子/分子权限校验，需结合 token scopes 做细粒度控制。
5. **文本/格式支持**：V2 流程文本提取仅支持文本类型，尚未处理 PDF、影像或 OCR 场景。
6. **文档与自动化**：集成流程缺少系统级文档与自动化测试，需补充部署指南、E2E 测试用例。

## 5. 后续重点计划

1. 完成 Cap0 封装与存储落盘，打通全链路胶囊生成与持久化。
2. 接入对象存储与真实预签名 URL，完善上传流程的配置校验与安全性。
3. 将 PKI 证书生命周期服务整合进 `capsula-bank`，支撑极简/标准两种证书申请模式。
4. 在胶囊访问 API 中引入原子/分子权限判定，形成“授权-使用-审计”的监管闭环。
5. 拓展文本解析与结构化抽取能力，覆盖医疗报告常见格式。
6. 完善文档体系（运行手册、架构图、场景示例）与自动化测试，支撑对外汇报与上线准备。
